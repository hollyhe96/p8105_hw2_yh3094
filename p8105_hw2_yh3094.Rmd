---
title: "p8105_hw2_yh3094"
author: "Yun He"
date: "September 27, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
```

# Problem 1

## Import and clean NYC transit dataset

```{r transit_data_clean}
transit_data = 
  read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  janitor::clean_names() %>% 
  select(line:entry, vending, ada) %>% 
  mutate(entry = recode(entry, 'YES' = TRUE, 'NO' = FALSE)) 
transit_data
```

The dataset contains variables of line, station name, station latitude / longitude, routes served, entry, vending, entrance type, and ADA compliance. I first imported the dataset using `read_csv`, cleaned all variable names using `janitor::clean_names`, and then preserved the variables that I wanted using `select`, and finally, I converted the entry variable from character (YES vs NO) to a logical variable (TRUE vs FALSE) using `recode`. After all cleaning steps above, the final dataset contains `r nrow(transit_data)` rows and `r ncol(transit_data)` columns. In my opinion, these data are untidy because the route variable was spreaded into 11 variables. 

## Calculate the sum of distinct stations 

```{r distinct_station_sum}
nrow(distinct(transit_data, line, station_name))
```

There are 465 distinct stations. 

## Calculate the sum of ADA compliant stations

```{r ada_station_sum}
sum(distinct(transit_data, line, station_name, ada)$ada)
```

There are 84 ADA compliant stations. 

## Calculate the proportion of stations without vending allow entrance

```{r without_vending_prop}
nrow(filter(transit_data, vending == 'NO'))/nrow(transit_data)
```

The proportion of station entrances / exits without vending allow entrance is 0.098.

## Reformat data so that route number and route name are distinct variables

```{r transit_data_reformat}
transit_data_reformat = 
  transit_data %>% 
  gather(key = route_number, value = route_name, route1:route11)
transit_data_reformat
```

## Calculate distinct stations that serve the A train

```{r a_train_sum}
transit_data_A = 
  transit_data_reformat %>% 
  filter(route_name == 'A')
nrow(distinct(transit_data_A, line, station_name))
```

There are 60 distinct stations that serve the A train.

## Calculate ADA compliant stations that serve the A train

```{r a_train_ada_sum}
filter(transit_data_A, ada == TRUE) %>% 
  distinct(line, station_name) %>% 
  nrow()
```

Of the stations that serve the A train, 17 are ADA compliant.

# Problem 2

## Import and clean the Mr. Trash Wheel sheet

```{r wheel_data_import}
wheel_data = 
  read_excel("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx",
             sheet = "Mr. Trash Wheel", range = cell_cols("A:N")) %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(sports_balls = round(sports_balls)) %>% 
  mutate(sports_balls = as.integer(sports_balls))
wheel_data
```

## Read and clean precipitation data for 2016 and 2017

```{r precipitation_data_import}
precipiation_data_2016 = 
  read_excel("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", 
             sheet = "2016 Precipitation", range = cell_rows(2:14)) %>%
  janitor::clean_names() %>%
  filter(!is.na(total)) %>% 
  mutate(year = 2016) 

precipitation_data_2017 = 
  read_excel("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", 
             sheet = "2017 Precipitation", range = cell_rows(2:14)) %>%
  janitor::clean_names() %>%
  filter(!is.na(total)) %>% 
  mutate(year = 2017)

precipitation_data = 
  full_join(precipiation_data_2016, precipitation_data_2017) %>% 
  mutate(month = month.name[month])
precipitation_data
```


# Problem 3
